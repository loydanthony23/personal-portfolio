name: Automated Updates

on:
  schedule:
    # Run every Monday at 9 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:  # Allow manual trigger

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check for outdated dependencies
      run: |
        echo "🔍 Checking for outdated dependencies..."
        echo "This is a static website, but we can check for:"
        echo "- CDN links in HTML files"
        echo "- External font links"
        echo "- Bootstrap and other vendor files"
        
        # Check Bootstrap version
        grep -r "bootstrap" index.html | head -5
        
        # Check for external CDN links
        grep -r "cdn\|googleapis\|jsdelivr" . --include="*.html" || echo "No CDN links found"
        
    - name: Security audit
      run: |
        echo "🔒 Running security audit..."
        # Check for known vulnerable patterns
        echo "Checking for potential security issues..."
        
        # Check for HTTP links (should be HTTPS)
        grep -r "http://" . --include="*.html" --include="*.css" --include="*.js" || echo "No HTTP links found"
        
    - name: Performance check
      run: |
        echo "⚡ Running performance check..."
        # Check image sizes
        echo "Image file sizes:"
        find assets/img -type f -name "*.jpg" -o -name "*.png" -o -name "*.gif" | head -10 | xargs ls -lh
        
    - name: Create issue if updates needed
      uses: actions/github-script@v7
      if: github.event_name == 'schedule'
      with:
        script: |
          const title = '📅 Weekly Resume Website Maintenance Check';
          const body = `## Weekly Maintenance Report
          
          This is an automated weekly check of your resume website.
          
          ### What was checked:
          - ✅ Dependency versions
          - ✅ Security patterns
          - ✅ Performance metrics
          - ✅ File sizes
          
          ### Recommendations:
          - Consider updating Bootstrap if a newer version is available
          - Review image file sizes for optimization
          - Check for any broken external links
          
          ### Next Steps:
          - Review this report
          - Update dependencies if needed
          - Optimize images if file sizes are large
          
          ---
          *This issue was automatically generated by GitHub Actions*`;
          
          // Check if issue already exists
          const issues = await github.rest.issues.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            state: 'open',
            labels: 'maintenance'
          });
          
          const existingIssue = issues.data.find(issue => issue.title === title);
          
          if (!existingIssue) {
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['maintenance', 'automated']
            });
          }
